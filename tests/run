#!/usr/bin/bash

readonly ATERM="java -jar ../bin/org.metaborg.sunshine2-2.5.2.jar parse -l ../lib/java.spfx/lang.java -p . -i"

for infile in "$@"
do
	echo "Running test '$infile'"

	javac ${infile} 2>&1 | tee ${infile%.java}.javac.out 
	java_ok=${PIPESTATUS[0]}

	jav=${infile%.java}.jav
	cp ${infile} $jav
	${ATERM} ${infile%.java}.jav > ${infile%.java}.aterm
	statix ../src/java.mstx ${infile%.java}.aterm 2>&1 | tee ${infile%.java}.stx.out
	stx_ok=${PIPESTATUS[0]}

	if [ $java_ok -eq $stx_ok ]
	then
		echo "SUCCESS"
	else
		echo "FAILURE"
	fi
done